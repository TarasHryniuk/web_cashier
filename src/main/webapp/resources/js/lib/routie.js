(function(f){var g=[],h={},p=f.routie,k=function(a,c){this.name=c;this.path=a;this.keys=[];this.fns=[];this.params={};this.regex=q(this.path,this.keys,!1,!1)};k.prototype.addHandler=function(a){this.fns.push(a)};k.prototype.removeHandler=function(a){for(var c=0,b=this.fns.length;c<b;c++)if(a==this.fns[c]){this.fns.splice(c,1);break}};k.prototype.run=function(a){for(var c=0,b=this.fns.length;c<b;c++)this.fns[c].apply(this,a)};k.prototype.match=function(a,c){var b=this.regex.exec(a);if(!b)return!1; for(var d=1,e=b.length;d<e;++d){var f=this.keys[d-1],g="string"==typeof b[d]?decodeURIComponent(b[d]):b[d];f&&(this.params[f.name]=g);c.push(g)}return!0};k.prototype.toURL=function(a){var c=this.path,b;for(b in a)c=c.replace("/:"+b,"/"+a[b]);c=c.replace(/\/:.*\?/g,"/").replace(/\?/g,"");if(-1!=c.indexOf(":"))throw Error("missing parameters for url: "+c);return c};var q=function(a,c,b,d){if(a instanceof RegExp)return a;a instanceof Array&&(a="("+a.join("|")+")");a=a.concat(d?"":"/?").replace(/\/\(/g, "(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,b,d,e,f,g){c.push({name:e,optional:!!g});b=b||"";return""+(g?"":b)+"(?:"+(g?b:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return new RegExp("^"+a+"(?:\\?(.+))?$",b?"":"i")},m=function(a,c){var b=a.split(" "),d=2==b.length?b[0]:null;a=2==b.length?b[1]:b[0];h[a]||(h[a]=new k(a,d),g.push(h[a]));h[a].addHandler(c)},e=function(a, c){if("function"==typeof c)m(a,c),e.reload();else if("object"==typeof a){for(var b in a)m(b,a[b]);e.reload()}else"undefined"===typeof c&&e.navigate(a)};e.lookup=function(a,c){for(var b=0,d=g.length;b<d;b++){var e=g[b];if(e.name==a)return e.toURL(c)}};e.remove=function(a,c){var b=h[a];b&&b.removeHandler(c)};e.removeAll=function(){h={};g=[]};e.navigate=function(a,c){c=c||{};var b=c.silent||!1;b&&(f.removeEventListener?f.removeEventListener("hashchange",l):f.detachEvent("onhashchange",l));setTimeout(function(){window.location.hash= a;b&&setTimeout(function(){n()},1)},1)};e.noConflict=function(){f.routie=p;return e};var l=e.reload=function(){for(var a=window.location.hash.substring(1),c=0,b=g.length;c<b;c++){var d;d=g[c];var e=[];d.match(a,e)?(d.run(e),d=!0):d=!1;if(d)break}},n=function(){f.addEventListener?f.addEventListener("hashchange",l,!1):f.attachEvent("onhashchange",l)};n();f.routie=e})(window);